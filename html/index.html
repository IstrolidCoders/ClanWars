<!DOCTYPE html>
<html>
    <head>
        <title>Istrolid Battle Records</title>
        <meta charset="UTF-8">
        <link rel="icon" href="/favicon.png" />
    </head>
    <body>
        <center>
            <b>Istrolid Battle Records</b>
            <table border="1">
                <thead>
                    <tr>
                        <td>Server</td>
                        <td>Type</td>
                        <td>Alpha</td>
                        <td>Beta</td>
                        <td>Side</td>
                    </tr>
                </thead>
                <tbody id="data"></tbody>
            </table>
        </center>
        <script>
            function updateData() {
                var http  = new XMLHttpRequest();
                http.onreadystatechange = () => {
                    if(http.readyState == 4 && http.status == 200) {
                        var rows = http.response;
                        if(Array.isArray(rows)) {
                            let data = ""
                            rows.forEach(e => {
                                data += "<tr><td>" + e.server + "</td><td>" + e.type + "<td><div>";
                                e.players.filter(p => p.side === "alpha").forEach(e => data += e.name + "<br/>");
                                data += "</div></td><td><div>"
                                e.players.filter(p => p.side === "beta").forEach(e => data += e.name + "<br/>");
                                data += "</div></td><td>" + e.win + "</td></tr>";
                            });

                            let table = document.getElementById('data');
                            table.innerHTML = data;
                        } else {
                            console.log("Invalid response");
                        }
                    }
                };
                http.responseType = 'json';
                http.open('GET', "/istrolid", true);
                http.send();
            }
            setInterval(updateData, 30000);
            updateData();
        </script>
    </body>
</html>
